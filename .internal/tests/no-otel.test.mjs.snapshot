exports[`no-otel > should put files 1`] = `
[
  "internal-tests-output-no-otel/.dockerignore",
  "internal-tests-output-no-otel/.editorconfig",
  "internal-tests-output-no-otel/.env",
  "internal-tests-output-no-otel/.env.sample",
  "internal-tests-output-no-otel/.env.test",
  "internal-tests-output-no-otel/.github/actions/setup-db/action.yml",
  "internal-tests-output-no-otel/.github/actions/setup-node/action.yml",
  "internal-tests-output-no-otel/.github/workflows/ci.yml",
  "internal-tests-output-no-otel/.gitignore",
  "internal-tests-output-no-otel/.node-version",
  "internal-tests-output-no-otel/.npmrc",
  "internal-tests-output-no-otel/.vscode/extensions.json",
  "internal-tests-output-no-otel/.vscode/mcp.json",
  "internal-tests-output-no-otel/.vscode/settings.json",
  "internal-tests-output-no-otel/Dockerfile",
  "internal-tests-output-no-otel/README.md",
  "internal-tests-output-no-otel/biome.json",
  "internal-tests-output-no-otel/compose.yml",
  "internal-tests-output-no-otel/env.ts",
  "internal-tests-output-no-otel/knip.config.ts",
  "internal-tests-output-no-otel/lefthook.yml",
  "internal-tests-output-no-otel/next.config.ts",
  "internal-tests-output-no-otel/package.json",
  "internal-tests-output-no-otel/playwright.config.ts",
  "internal-tests-output-no-otel/pnpm-lock.yaml",
  "internal-tests-output-no-otel/pnpm-workspace.yaml",
  "internal-tests-output-no-otel/postcss.config.mjs",
  "internal-tests-output-no-otel/prisma.config.ts",
  "internal-tests-output-no-otel/prisma/schema/item.prisma",
  "internal-tests-output-no-otel/prisma/schema/migrations/migration_lock.toml",
  "internal-tests-output-no-otel/prisma/schema/schema.prisma",
  "internal-tests-output-no-otel/prisma/schema/user.prisma",
  "internal-tests-output-no-otel/public/.gitkeep",
  "internal-tests-output-no-otel/renovate.json",
  "internal-tests-output-no-otel/tests/db.setup.ts",
  "internal-tests-output-no-otel/tests/vitest.helper.ts",
  "internal-tests-output-no-otel/tests/vitest.setup.ts",
  "internal-tests-output-no-otel/tsconfig.json",
  "internal-tests-output-no-otel/vitest.config.ts",
  "mocked/migration.sql"
]
`;

exports[`no-otel > should update .env.sample 1`] = `
[
  "# Next.js",
  "NEXT_PUBLIC_SITE_URL=http://localhost:3000",
  "",
  "# Database",
  "DATABASE_USER=local",
  "DATABASE_PASSWORD=1234",
  "DATABASE_DB=local",
  "DATABASE_HOST=localhost",
  "DATABASE_PORT=5432",
  "DATABASE_SCHEMA=public",
  "# for prisma migration, not used in development, test and production",
  "DATABASE_URL=postgresql://\${DATABASE_USER}:\${DATABASE_PASSWORD}@\${DATABASE_HOST}:\${DATABASE_PORT}/\${DATABASE_DB}?schema=\${DATABASE_SCHEMA}",
  "",
  "# Google OAuth",
  "# https://console.cloud.google.com/apis/credentials",
  "# Set values below",
  "# AUTHORIZED JAVASCRIPT ORIGINS: http://localhost:3000",
  "# AUTHORIZED REDIRECT URIS: http://localhost:3000/api/auth/callback/google",
  "GOOGLE_CLIENT_ID=xxxx",
  "GOOGLE_CLIENT_SECRET=xxxx",
  "",
  "# NextAuth.js",
  "NEXTAUTH_URL=\${NEXT_PUBLIC_SITE_URL}",
  "# https://next-auth.js.org/configuration/options#secret",
  "# you must generate a new secret",
  "# error: \\"ikm\\" must be at least one byte in length'",
  "# $ openssl rand -base64 32",
  "NEXTAUTH_SECRET=TKDdLVjf7cTyTs5oWVpv04senu6fia4RGQbYHRQIR5Q=",
  "",
  "",
  "# Stripe",
  "STRIPE_SECRET_KEY=xxxx",
  "STRIPE_WEBHOOK_SECRET=xxxx",
  "STRIPE_PRICE_ID=xxxx",
  "",
  "SENTRY_ORG=",
  "SENTRY_PROJECT=",
  "SENTRY_AUTH_TOKEN=",
  "NEXT_PUBLIC_SENTRY_DSN=",
  ""
]
`;

exports[`no-otel > should update .env.test 1`] = `
[
  "# Google OAuth",
  "GOOGLE_CLIENT_ID=dummy",
  "GOOGLE_CLIENT_SECRET=dummy",
  "",
  "# NextAuth.js",
  "NEXTAUTH_TEST_MODE=true",
  "",
  "# Stripe",
  "STRIPE_SECRET_KEY=dummy",
  "STRIPE_WEBHOOK_SECRET=dummy",
  "STRIPE_PRICE_ID=dummy",
  ""
]
`;

exports[`no-otel > should update .github/workflows/ci.yml 1`] = `
[
  "name: ci",
  "",
  "on:",
  "  pull_request:",
  "    branches:",
  "      - main",
  "    paths:",
  "      - .github/workflows/ci.yml",
  "      - package.json",
  "      - src/**",
  "      - e2e/**",
  "      - Dockerfile",
  "  push:",
  "    branches:",
  "      - main",
  "    paths:",
  "      - .github/workflows/ci.yml",
  "      - package.json",
  "      - src/**",
  "      - e2e/**",
  "      - Dockerfile",
  "",
  "jobs:",
  "  lint:",
  "    runs-on: ubuntu-latest",
  "    steps:",
  "      - uses: actions/checkout@v5",
  "      - uses: ./.github/actions/setup-node",
  "      - run: pnpm lint",
  "      - run: npx biome check . && npx prettier --check './**/*.{md,yml}'",
  "  build:",
  "    runs-on: ubuntu-latest",
  "    steps:",
  "      - uses: actions/checkout@v5",
  "      - uses: ./.github/actions/setup-node",
  "      - uses: ./.github/actions/setup-db",
  "      - run: pnpm build",
  "  build-docker:",
  "    runs-on: ubuntu-latest",
  "    env:",
  "      NEXT_PUBLIC_SITE_URL: http://localhost:3000",
  "    steps:",
  "      - uses: actions/checkout@v5",
  "      - uses: ./.github/actions/setup-node",
  "      - uses: ./.github/actions/setup-db",
  "      - run: |",
  "          docker build \\\\",
  "            -t app \\\\",
  "            -f Dockerfile \\\\",
  "            --add-host=host.docker.internal:host-gateway \\\\",
  "            --build-arg DATABASE_USER=\${{env.DATABASE_USER}} \\\\",
  "            --build-arg DATABASE_PASSWORD=\${{env.DATABASE_PASSWORD}} \\\\",
  "            --build-arg DATABASE_DB=\${{env.DATABASE_DB}} \\\\",
  "            --build-arg DATABASE_HOST=\${{env.DATABASE_HOST}} \\\\",
  "            --build-arg DATABASE_PORT=\${{env.DATABASE_PORT}} \\\\",
  "            --build-arg DATABASE_SCHEMA=\${{env.DATABASE_SCHEMA}} \\\\",
  "            --build-arg GOOGLE_CLIENT_ID=\${{env.GOOGLE_CLIENT_ID}} \\\\",
  "            --build-arg GOOGLE_CLIENT_SECRET=\${{env.GOOGLE_CLIENT_SECRET}} \\\\",
  "            --build-arg NEXT_PUBLIC_SITE_URL=\${{env.NEXT_PUBLIC_SITE_URL}} \\\\",
  "            --build-arg NEXTAUTH_SECRET=\${{env.NEXTAUTH_SECRET}} \\\\",
  "            --build-arg STRIPE_PRICE_ID=\${{env.STRIPE_PRICE_ID}} \\\\",
  "            --build-arg STRIPE_SECRET_KEY=\${{env.STRIPE_SECRET_KEY}} \\\\",
  "            --build-arg STRIPE_WEBHOOK_SECRET=\${{env.STRIPE_WEBHOOK_SECRET}} \\\\",
  "            .",
  "        env:",
  "          # please set the following environment variables as github secrets",
  "          DATABASE_USER: local",
  "          DATABASE_PASSWORD: 1234",
  "          DATABASE_DB: local",
  "          DATABASE_HOST: host.docker.internal",
  "          DATABASE_PORT: 5432",
  "          DATABASE_SCHEMA: public",
  "          NEXTAUTH_SECRET: TKDdLVjf7cTyTs5oWVpv04senu6fia4RGQbYHRQIR5Q=",
  "          GOOGLE_CLIENT_ID: dummy",
  "          GOOGLE_CLIENT_SECRET: dummy",
  "          STRIPE_PRICE_ID: price_1",
  "          STRIPE_SECRET_KEY: pk_test_1",
  "          STRIPE_WEBHOOK_SECRET: whsec_1",
  "      - run: docker run -d -p 3000:3000 app",
  "      - run: |",
  "          until $(curl --output /dev/null --silent --fail \${{env.NEXT_PUBLIC_SITE_URL}}); do",
  "            printf '!'",
  "            sleep 1",
  "          done",
  "        timeout-minutes: 1",
  "  unit-test:",
  "    runs-on: ubuntu-latest",
  "    steps:",
  "      - uses: actions/checkout@v5",
  "      - uses: ./.github/actions/setup-node",
  "      - run: pnpm test",
  "  e2e-test:",
  "    runs-on: ubuntu-latest",
  "    steps:",
  "      - uses: actions/checkout@v5",
  "      - uses: ./.github/actions/setup-node",
  "      - uses: ./.github/actions/setup-db",
  "      - run: pnpm exec playwright install chromium",
  "      - run: pnpm build",
  "      - run: pnpm test:e2e",
  ""
]
`;

exports[`no-otel > should update Dockerfile 1`] = `
[
  "FROM node:22.21.0-slim AS base",
  "",
  "ARG DATABASE_USER=''",
  "ARG DATABASE_PASSWORD=''",
  "ARG DATABASE_DB=''",
  "ARG DATABASE_HOST=''",
  "ARG DATABASE_PORT=''",
  "ARG DATABASE_SCHEMA=''",
  "ARG GOOGLE_CLIENT_ID=''",
  "ARG GOOGLE_CLIENT_SECRET=''",
  "ARG NEXT_PUBLIC_SITE_URL=''",
  "ARG NEXTAUTH_SECRET=''",
  "ARG STRIPE_PRICE_ID=''",
  "ARG STRIPE_SECRET_KEY=''",
  "ARG STRIPE_WEBHOOK_SECRET=''",
  "",
  "ENV PNPM_HOME=\\"/pnpm\\"",
  "ENV PATH=\\"$PNPM_HOME:$PATH\\"",
  "ENV DATABASE_USER=$DATABASE_USER",
  "ENV DATABASE_PASSWORD=$DATABASE_PASSWORD",
  "ENV DATABASE_DB=$DATABASE_DB",
  "ENV DATABASE_HOST=$DATABASE_HOST",
  "ENV DATABASE_PORT=$DATABASE_PORT",
  "ENV DATABASE_SCHEMA=$DATABASE_SCHEMA",
  "ENV GOOGLE_CLIENT_ID=$GOOGLE_CLIENT_ID",
  "ENV GOOGLE_CLIENT_SECRET=$GOOGLE_CLIENT_SECRET",
  "ENV NEXT_PUBLIC_SITE_URL=$NEXT_PUBLIC_SITE_URL",
  "ENV NEXTAUTH_SECRET=$NEXTAUTH_SECRET",
  "ENV NEXTAUTH_URL=$NEXT_PUBLIC_SITE_URL",
  "ENV STRIPE_PRICE_ID=$STRIPE_PRICE_ID",
  "ENV STRIPE_SECRET_KEY=$STRIPE_SECRET_KEY",
  "ENV STRIPE_WEBHOOK_SECRET=$STRIPE_WEBHOOK_SECRET",
  "",
  "COPY . /app",
  "WORKDIR /app",
  "",
  "RUN npm run setup",
  "# for prisma",
  "RUN apt-get update -y && apt-get install -y openssl",
  "",
  "FROM base AS prod-deps",
  "",
  "RUN --mount=type=cache,id=pnpm,target=/pnpm/store pnpm i --prod --frozen-lockfile",
  "RUN pnpm prisma generate --generator client",
  "",
  "FROM base AS build",
  "",
  "RUN --mount=type=cache,id=pnpm,target=/pnpm/store pnpm i --frozen-lockfile",
  "RUN pnpm build",
  "",
  "FROM base AS app",
  "",
  "COPY --from=prod-deps /app/node_modules /app/node_modules",
  "COPY --from=build /app/.next /app/.next",
  "",
  "EXPOSE 3000",
  "CMD [\\"pnpm\\", \\"start\\"]",
  ""
]
`;

exports[`no-otel > should update README.md 1`] = `
[
  "## Setup",
  "",
  "\`\`\`sh",
  "# enable corepack",
  "$ npm run setup",
  "# install deps",
  "$ pnpm i",
  "# create \\".env\\" and modify environment variables",
  "$ cp .env.sample .env",
  "\`\`\`",
  "",
  "## Development",
  "",
  "\`\`\`sh",
  "$ pnpm dev",
  "\`\`\`",
  "",
  "### Debugging Stripe",
  "",
  "1. Create a subscription [here](https://dashboard.stripe.com/test/products?active=true&create=product&source=product_list) and get \`price_id\`.",
  "",
  "2. Modify the environment variables. The test API key is [here](https://dashboard.stripe.com/test/apikeys).",
  "",
  "\`\`\`sh",
  "STRIPE_SECRET_KEY=",
  "STRIPE_PRICE_ID=",
  "\`\`\`",
  "",
  "3. [Install stripe CLI](https://docs.stripe.com/stripe-cli) to bypass the webhook.",
  "",
  "4. Execute the following command in another terminal.",
  "",
  "\`\`\`sh",
  "$ pnpm dev:stripe",
  "\`\`\`",
  "",
  "5. Add webhook signing secret like \`whsec_...\` from the cli output to env file",
  "",
  "\`\`\`",
  "STRIPE_WEBHOOK_SECRET=whsec_...",
  "\`\`\`",
  "",
  "6. After signing in, you can go to the \`http://localhost:3000/me/payment\` page to see how to make a payment.",
  "",
  "## Production",
  "",
  "\`\`\`sh",
  "$ pnpm db:up",
  "$ pnpm build",
  "$ pnpm start",
  "\`\`\`",
  "",
  "## Test",
  "",
  "### Unit Test",
  "",
  "\`\`\`sh",
  "$ pnpm test",
  "$ pnpm test:watch",
  "\`\`\`",
  "",
  "### E2E Test",
  "",
  "A build task must be executed before running tests to bypass JWT logic.",
  "",
  "\`\`\`sh",
  "# install chrome",
  "$ pnpm exec playwright install chrome",
  "",
  "$ pnpm build",
  "",
  "$ pnpm test:e2e",
  "$ pnpm test:e2e:ui",
  "\`\`\`",
  "",
  "## Database",
  "",
  "\`\`\`sh",
  "$ pnpm db:migrate",
  "$ pnpm db:reset",
  "# view the database items",
  "$ pnpm db:studio",
  "\`\`\`",
  "",
  "## Links",
  "",
  "- [Web App Template](https://hiroppy.github.io/web-app-template/)",
  ""
]
`;

exports[`no-otel > should update compose.yml 1`] = `
[
  "volumes:",
  "  db-data:",
  "",
  "services:",
  "  db:",
  "    image: postgres:18",
  "    ports:",
  "      - \${DATABASE_PORT:-5432}:5432",
  "    environment:",
  "      - POSTGRES_USER=\${DATABASE_USER}",
  "      - POSTGRES_PASSWORD=\${DATABASE_PASSWORD}",
  "      - POSTGRES_DB=\${DATABASE_DB}",
  "    volumes:",
  "      - db-data:/var/lib/postgresql/data",
  "    healthcheck:",
  "      test: [\\"CMD-SHELL\\", \\"pg_isready\\"]",
  "      interval: 1s",
  "      timeout: 5s",
  "      retries: 10",
  ""
]
`;

exports[`no-otel > should update dependencies 1`] = `
{
  "dependencies": [
    "@auth/prisma-adapter",
    "@hookform/resolvers",
    "@next/env",
    "@prisma/client",
    "@sentry/nextjs",
    "@sentry/profiling-node",
    "clsx",
    "next",
    "next-auth",
    "prisma",
    "react",
    "react-dom",
    "react-hook-form",
    "stripe",
    "zod"
  ],
  "devDependencies": [
    "@axe-core/playwright",
    "@biomejs/biome",
    "@playwright/test",
    "@tailwindcss/postcss",
    "@testing-library/react",
    "@types/node",
    "@types/react",
    "@types/react-dom",
    "@vitejs/plugin-react",
    "jsdom",
    "knip",
    "lefthook",
    "prettier",
    "tailwindcss",
    "testcontainers",
    "typescript",
    "vitest"
  ]
}
`;

exports[`no-otel > should update env.ts 1`] = `
[
  "import { loadEnvConfig } from \\"@next/env\\";",
  "import { z } from \\"zod\\";",
  "",
  "const staticEnv = z.object({",
  "  NODE_ENV: z",
  "    .union([",
  "      z.literal(\\"development\\"),",
  "      z.literal(\\"test\\"),",
  "      z.literal(\\"production\\"),",
  "    ])",
  "    .default(\\"development\\"),",
  "",
  "  // for client and server",
  "  NEXT_PUBLIC_SITE_URL: z.url(),",
  "",
  "  // for server",
  "  DATABASE_USER: z.string().min(1),",
  "  DATABASE_PASSWORD: z.string().min(1),",
  "  DATABASE_DB: z.string().min(1),",
  "  DATABASE_HOST: z.string().min(1),",
  "  DATABASE_PORT: z.coerce.number().min(1),",
  "  DATABASE_SCHEMA: z.string().min(1),",
  "",
  "  GOOGLE_CLIENT_ID: z.string().min(1),",
  "  GOOGLE_CLIENT_SECRET: z.string().min(1),",
  "",
  "  NEXTAUTH_URL: z.string().min(1),",
  "  NEXTAUTH_SECRET: z.string().min(1),",
  "",
  "  STRIPE_PRICE_ID: z.string().min(1),",
  "  STRIPE_SECRET_KEY: z.string().min(1),",
  "  STRIPE_WEBHOOK_SECRET: z.string().min(1),",
  "",
  "  SENTRY_ORG: z.string().min(1).optional().or(z.literal(\\"\\")),",
  "  SENTRY_PROJECT: z.string().min(1).optional().or(z.literal(\\"\\")),",
  "  SENTRY_AUTH_TOKEN: z.string().min(1).optional().or(z.literal(\\"\\")),",
  "  NEXT_PUBLIC_SENTRY_DSN: z.string().min(1).optional().or(z.literal(\\"\\")),",
  "});",
  "",
  "const runtimeEnv = z.object({});",
  "",
  "export type Schema = z.infer<typeof schema>;",
  "",
  "const schema = z.intersection(staticEnv, runtimeEnv);",
  "",
  "export function config(kind: \\"static\\" | \\"runtime\\" = \\"static\\") {",
  "  const { combinedEnv } = loadEnvConfig(process.cwd());",
  "  const res =",
  "    kind === \\"static\\"",
  "      ? staticEnv.safeParse(combinedEnv)",
  "      : runtimeEnv.safeParse(combinedEnv);",
  "",
  "  if (res.error) {",
  "    console.error(\\"\\\\x1b[31m%s\\\\x1b[0m\\", \\"[Errors] environment variables\\");",
  "    console.error(JSON.stringify(res.error.issues, null, 2));",
  "    process.exit(1);",
  "  }",
  "}",
  ""
]
`;

exports[`no-otel > should update next.config.ts 1`] = `
[
  "import { withSentryConfig } from \\"@sentry/nextjs\\";",
  "import type { NextConfig } from \\"next\\";",
  "import { config } from \\"./env\\";",
  "",
  "config();",
  "",
  "const nextConfig: NextConfig = {",
  "  async headers() {",
  "    return [",
  "      {",
  "        source: \\"/(.*?)\\",",
  "        headers: [",
  "          {",
  "            key: \\"X-Frame-Options\\",",
  "            value: \\"DENY\\",",
  "          },",
  "          {",
  "            key: \\"X-DNS-Prefetch-Control\\",",
  "            value: \\"on\\",",
  "          },",
  "          {",
  "            key: \\"X-XSS-Protection\\",",
  "            value: \\"1; mode=block\\",",
  "          },",
  "          {",
  "            key: \\"X-Content-Type-Options\\",",
  "            value: \\"nosniff\\",",
  "          },",
  "          {",
  "            key: \\"Referrer-Policy\\",",
  "            value: \\"origin-when-cross-origin\\",",
  "          },",
  "        ],",
  "      },",
  "      {",
  "        source: \\"/:path*\\",",
  "        headers: [",
  "          {",
  "            key: \\"Document-Policy\\",",
  "            value: \\"js-profiling\\",",
  "          },",
  "        ],",
  "      },",
  "    ];",
  "  },",
  "  images: {",
  "    remotePatterns: [",
  "      {",
  "        protocol: \\"https\\",",
  "        hostname: \\"lh3.googleusercontent.com\\",",
  "      },",
  "    ],",
  "  },",
  "  typedRoutes: true,",
  "  experimental: {",
  "    authInterrupts: true,",
  "    sri: {",
  "      algorithm: \\"sha256\\",",
  "    },",
  "  },",
  "};",
  "",
  "export default withSentryConfig(nextConfig, {",
  "  org: process.env.SENTRY_ORG,",
  "  project: process.env.SENTRY_PROJECT,",
  "  silent: !process.env.CI,",
  "  widenClientFileUpload: true,",
  "  authToken: process.env.SENTRY_AUTH_TOKEN,",
  "  disableLogger: true,",
  "  reactComponentAnnotation: {",
  "    enabled: true,",
  "  },",
  "});",
  ""
]
`;
